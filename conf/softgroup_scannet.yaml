general:
  manual_seed: 123
  dataset: scannet
  model: softgroup
  output_root: output/

data:
  module: lib.dataset
  dataset: ScanNet
  loader: scannet_loader
  data_root: dataset
  file_suffix: .pth


  classes: 20
  ignore_label: -1 # ignored classes
  ignore_classes: [0, 1]
  class_names: ['cabinet', 'bed', 'chair', 'sofa', 'table', 'door', 'window', 'bookshelf', 'picture',
               'counter', 'desk', 'curtain', 'refrigerator', 'shower curtain', 'toilet', 'sink',
               'bathtub', 'otherfurniture']

  scale: 50   # voxel_size = 1 / scale, scale 50(2cm)
  batch_size: 2
  num_workers: 8
  full_scale: [128, 512]
  max_num_point: 250000
  max_num_instance: 128
  mode: 4 # 4=mean

  augmentation:
    jitter_xyz: True
    flip: True
    rotation: True
    elastic: True
    jitter_rgb: True
    
  requires_bbox: True
  requires_gt_mask: False
  requires_gt_feats: False


model:
  name: softgroup
  module: model
  classname: SoftGroup
  
  # input_channel: 131 # multiview + normals
  m: 16 # 16 or 32
  blocks: [1, 2, 3, 4, 5, 6, 7]
  cluster_blocks: [1, 2]
  block_residual: True
  block_reps: 2

  use_coords: True
  use_color: True
  use_multiview: False
  use_normal: False
  crop_bbox: False
  pred_bbox: False

  num_bbox_class: 18
  num_heading_bin: 1
  num_size_cluster: 18
  max_num_proposal: 128

  use_checkpoint:
  pretrained_path: #/local-scratch/qiruiw/research/pointgroup-minkowski/log/scannet/pointgroup/train/2021-09-18_01-04-52/ckp-00512.tar #/local-scratch/qiruiw/research/pointgroup-minkowski/log/scannet/pointgroup/train/2021-08-24_11-42-20/ckp-00480.tar
  pretrained_module: #[backbone] # [backbone, sem_seg, offset_net, score_net, score_linear]
  pretrained_module_path: #/local-scratch/qiruiw/research/dense-scanrefer/log/scannet/pointgroup/train/2021-02-10_01-53-53/pointgroup_default_scannet-000000480.pth
  freeze_module: []
  freeze_backbone: False
  prepare_epochs: 128

  grouping_cfg:
    score_thr: 0.2
    radius: 0.04
    mean_active: 300
    class_numpoint_mean: [ -1., -1., 3917., 12056., 2303.,
                           8331., 3948., 3166., 5629., 11719.,
                           1003., 3317., 4912., 10221., 3889.,
                           4136., 2120., 945., 3967., 2589. ]
    npoint_thr: 0.05  # absolute if class_numpoint == -1, relative if class_numpoint != -1

  instance_voxel_cfg:
    scale: 50
    spatial_shape: 20
  train_cfg:
    max_proposal_num: 200
    pos_iou_thr: 0.5
  test_cfg:
    cls_score_thr: 0.001
    mask_score_thr: -0.5
    min_npoint: 100


train:
  epochs: 512 # 480
  num_sanity_val_steps: 20
  log_every_n_steps: 50
  check_val_every_n_epoch: 8
  save_checkpoint_every_n_epochs: 8  # negative number n means to save the best n models
  clear_cache_every_n_epochs: 4
  monitor: val_accuracy/AP_50

  optim: 
    classname: Adam # Adam or SGD
    lr: 0.001
    momentum: 0.9 # SGD
    weight_decay: 0.0001 # SGD
  
  multiplier: 0.5
  loss_weight: [1, 1, 1, 1, 1, 1] # semantic_loss, offset_norm_loss, offset_dir_loss, score_loss, bbox_loss (if applies)

  fg_thresh: 0.75
  bg_thresh: 0.25

  score_scale: 50 # the minimal voxel size is 2cm
  score_fullscale: 14
  score_mode: 4 # mean
  

test:
  use_exp: #DETECTOR #XYZ_MULTIVIEW_NORMAL #XYZ-RGB-2021-02-10_01-53-53

  test_epoch: 384
  test_seed: 567

  TEST_NMS_THRESH: 0.3
  TEST_SCORE_THRESH: 0.09
  TEST_NPOINT_THRESH: 100

  requires_visualize: True


evaluation:
  model_utils_module: data.scannet.model_util_scannet
  gt_class_name: NYU20_CLASS_NAME
  gt_class_idx: NYU20_CLASS_IDX

  task:
  use_model: #DETECTOR #XYZ_MULTIVIEW_NORMAL #XYZ-RGB-2021-02-10_01-53-53

  detection:
    per_class_proposal: True

